<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PokemonTeamBuilder.MainPage"
             Title="Pokédex">

    <Grid Padding="16" RowSpacing="12">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Frame x:Name="searchBarFrame" Grid.Row="0" Padding="0" CornerRadius="25" HasShadow="False"
               BackgroundColor="{DynamicResource FrameBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}">
            <SearchBar x:Name="searchBar"
                       Placeholder="Search Pokémon..."
                       TextChanged="searchBar_TextChanged"
                       SearchButtonPressed="OnSearchBarPressed"
                       BackgroundColor="Transparent"
                       HorizontalOptions="Fill" />
        </Frame>

        <Frame Grid.Row="1" Padding="0" CornerRadius="12" HasShadow="False"
               IsVisible="{Binding Source={x:Reference suggestionListView}, Path=IsVisible}"
               BackgroundColor="{DynamicResource CardBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}">
            <ListView x:Name="suggestionListView"
                      ItemSelected="suggestionListView_ItemSelected"
                      HeightRequest="150"
                      IsVisible="False"
                      BackgroundColor="Transparent"
                      SeparatorColor="{DynamicResource DividerColor}"
                      HorizontalOptions="Fill" />
        </Frame>

        <Frame x:Name="filterFrame" Grid.Row="2" Padding="12,8" CornerRadius="12" HasShadow="False"
               BackgroundColor="{DynamicResource CardBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}">
            <Grid ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Button x:Name="backToTeamButton" Grid.Column="0"
                        Text="← Back to Team"
                        IsVisible="False"
                        BackgroundColor="{DynamicResource SecondaryColor}"
                        FontSize="12" Padding="12,8" VerticalOptions="Center"
                        Clicked="OnBackToTeamClicked" />

                <Button x:Name="typeFilterButton" Grid.Column="1" Text="Types ▼" 
                        Clicked="OnTypeFilterButtonClicked"
                        BackgroundColor="{DynamicResource SurfaceColor}"
                        TextColor="{DynamicResource TextColor}"
                        FontSize="12" Padding="12,8" VerticalOptions="Center" />

                <HorizontalStackLayout Grid.Column="2" Spacing="6" VerticalOptions="Center">
                    <Label Text="Gen:" VerticalOptions="Center" />
                    <Picker x:Name="generationFilterPicker" WidthRequest="90" 
                            BackgroundColor="{DynamicResource SurfaceColor}"
                            SelectedIndexChanged="OnFilterChanged">
                        <Picker.Items>
                            <x:String>All</x:String>
                            <x:String>Gen 1</x:String>
                            <x:String>Gen 2</x:String>
                            <x:String>Gen 3</x:String>
                            <x:String>Gen 4</x:String>
                            <x:String>Gen 5</x:String>
                            <x:String>Gen 6</x:String>
                            <x:String>Gen 7</x:String>
                            <x:String>Gen 8</x:String>
                            <x:String>Gen 9</x:String>
                        </Picker.Items>
                    </Picker>
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="3" Spacing="6" VerticalOptions="Center">
                    <Label Text="Rarity:" VerticalOptions="Center" />
                    <Picker x:Name="rarityFilterPicker" WidthRequest="110" 
                            BackgroundColor="{DynamicResource SurfaceColor}"
                            SelectedIndexChanged="OnFilterChanged">
                        <Picker.Items>
                            <x:String>All</x:String>
                            <x:String>Legendary</x:String>
                            <x:String>Mythical</x:String>
                            <x:String>Regular</x:String>
                        </Picker.Items>
                    </Picker>
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="4" Spacing="6" VerticalOptions="Center">
                    <CheckBox x:Name="favouritesCheckBox" 
                              CheckedChanged="OnFavouritesFilterChanged"
                              VerticalOptions="Center" 
                              Margin="5,0,-90,0"/>
                    <Label Text="★ Favourites" VerticalOptions="Center" />
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="5" Spacing="6" VerticalOptions="Center">
                    <Label Text="Min TBS:" VerticalOptions="Center" />
                    <Entry x:Name="minTbsEntry" Keyboard="Numeric" Placeholder="0" WidthRequest="55" 
                           BackgroundColor="{DynamicResource SurfaceColor}"
                           TextChanged="OnFilterChanged"/>
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="6" Spacing="6" VerticalOptions="Center">
                    <Label Text="Max TBS:" VerticalOptions="Center" />
                    <Entry x:Name="maxTbsEntry" Keyboard="Numeric" Placeholder="999" WidthRequest="55" 
                           BackgroundColor="{DynamicResource SurfaceColor}"
                           TextChanged="OnFilterChanged"/>
                </HorizontalStackLayout>

                <HorizontalStackLayout Grid.Column="7" Spacing="6" VerticalOptions="Center">
                    <Label Text="Sort:" VerticalOptions="Center" />
                    <Picker x:Name="sortPicker" WidthRequest="130" 
                            BackgroundColor="{DynamicResource SurfaceColor}"
                            SelectedIndexChanged="OnSortChanged">
                        <Picker.Items>
                            <x:String>Dex # ↑</x:String>
                            <x:String>Dex # ↓</x:String>
                            <x:String>A-Z</x:String>
                            <x:String>Z-A</x:String>
                            <x:String>BST ↑</x:String>
                            <x:String>BST ↓</x:String>
                            <x:String>HP ↑</x:String>
                            <x:String>HP ↓</x:String>
                            <x:String>Attack ↑</x:String>
                            <x:String>Attack ↓</x:String>
                            <x:String>Defense ↑</x:String>
                            <x:String>Defense ↓</x:String>
                            <x:String>Sp. Atk ↑</x:String>
                            <x:String>Sp. Atk ↓</x:String>
                            <x:String>Sp. Def ↑</x:String>
                            <x:String>Sp. Def ↓</x:String>
                            <x:String>Speed ↑</x:String>
                            <x:String>Speed ↓</x:String>
                        </Picker.Items>
                    </Picker>
                </HorizontalStackLayout>

                <Button Grid.Column="8" Text="Clear" Clicked="OnClearFiltersClicked" 
                        BackgroundColor="{DynamicResource SecondaryColor}"
                        FontSize="12" Padding="12,8" VerticalOptions="Center" />
            </Grid>
        </Frame>

        <Frame x:Name="typeFilterDropdown" Grid.Row="3" Padding="12" CornerRadius="12" HasShadow="False"
               IsVisible="False"
               BackgroundColor="{DynamicResource CardBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}">
            <VerticalStackLayout Spacing="8">
                <HorizontalStackLayout>
                    <Label Text="Select Types:" FontAttributes="Bold" VerticalOptions="Center" />
                    <Button Text="Done" Clicked="OnTypeFilterDoneClicked" 
                            BackgroundColor="{DynamicResource AccentColor}"
                            FontSize="12" Padding="8,4" Margin="12,0,0,0" />
                </HorizontalStackLayout>
                <Grid ColumnSpacing="0" RowSpacing="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="0" VerticalOptions="Center">
                        <CheckBox x:Name="fireCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Fire" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="1" VerticalOptions="Center">
                        <CheckBox x:Name="waterCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Water" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="2" VerticalOptions="Center">
                        <CheckBox x:Name="grassCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Grass" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="3" VerticalOptions="Center">
                        <CheckBox x:Name="electricCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Electric" VerticalOptions="Center" Margin="-90,0,5,0" />
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="4" VerticalOptions="Center">
                        <CheckBox x:Name="psychicCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Psychic" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="5" VerticalOptions="Center">
                        <CheckBox x:Name="iceCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Ice" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="6" VerticalOptions="Center">
                        <CheckBox x:Name="dragonCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Dragon" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="7" VerticalOptions="Center">
                        <CheckBox x:Name="darkCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Dark" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="0" Grid.Column="8" VerticalOptions="Center">
                        <CheckBox x:Name="fairyCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Fairy" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="0" VerticalOptions="Center">
                        <CheckBox x:Name="normalCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Normal" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="1" VerticalOptions="Center">
                        <CheckBox x:Name="fightingCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Fighting" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="2" VerticalOptions="Center">
                        <CheckBox x:Name="flyingCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Flying" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="3" VerticalOptions="Center">
                        <CheckBox x:Name="poisonCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Poison" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="4" VerticalOptions="Center">
                        <CheckBox x:Name="groundCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Ground" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="5" VerticalOptions="Center">
                        <CheckBox x:Name="rockCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Rock" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="6" VerticalOptions="Center">
                        <CheckBox x:Name="bugCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Bug" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="7" VerticalOptions="Center">
                        <CheckBox x:Name="ghostCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Ghost" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="8" VerticalOptions="Center">
                        <CheckBox x:Name="steelCheckBox" CheckedChanged="OnTypeFilterChanged" />
                        <Label Text="Steel" VerticalOptions="Center" Margin="-90,0,5,0"/>
                    </HorizontalStackLayout>
                </Grid>
            </VerticalStackLayout>
        </Frame>

        <!-- Pokemon Grid -->
        <CollectionView x:Name="allPokemonCollectionView"
                        Grid.Row="4"
                        IsVisible="True"
                        SelectionMode="Single"
                        SelectionChanged="AllPokemonCollectionView_SelectionChanged"
                        BackgroundColor="Transparent">

            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" Span="4" HorizontalItemSpacing="8" VerticalItemSpacing="8" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="8" CornerRadius="16" HasShadow="False"
                           BackgroundColor="{DynamicResource CardBackgroundColor}"
                           BorderColor="{DynamicResource BorderColor}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                            <Frame WidthRequest="70" HeightRequest="70" CornerRadius="35" 
                                   Padding="5" HasShadow="False"
                                   BackgroundColor="{DynamicResource SurfaceColor}"
                                   BorderColor="Transparent">
                                <Image Source="{Binding SpriteUrl}"
                                       WidthRequest="60"
                                       HeightRequest="60"
                                       Aspect="AspectFit" />
                            </Frame>
                            <Label Text="{Binding Name}"
                                   FontSize="11"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="1"/>
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
        
        <!-- Pokemon Details Grid -->
        <Frame x:Name="pokemonDetailsGrid" 
               Grid.Row="0" 
               Grid.RowSpan="5"
               Padding="24"
               CornerRadius="20"
               IsVisible="False"
               BackgroundColor="{DynamicResource CardBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}"
               HasShadow="False"
               HorizontalOptions="Fill"
               VerticalOptions="Fill">

            <Grid ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Left Column-->
                <Frame Grid.Column="0" 
                       Padding="20" 
                       CornerRadius="16" 
                       HasShadow="False"
                       BackgroundColor="{DynamicResource SurfaceColor}"
                       BorderColor="{DynamicResource BorderColor}">
                    <ScrollView>
                        <VerticalStackLayout Spacing="12" HorizontalOptions="Fill">

                            <Button x:Name="backButton"
                                    Text="← Back"
                                    FontSize="14"
                                    Clicked="OnBackButtonClicked"
                                    BackgroundColor="{DynamicResource SecondaryColor}"
                                    HorizontalOptions="Start" />

                            <!-- Sprite -->
                            <Frame WidthRequest="140" HeightRequest="140" CornerRadius="70" 
                                   Padding="8" HasShadow="False"
                                   BackgroundColor="{DynamicResource CardBackgroundColor}"
                                   BorderColor="{DynamicResource BorderColor}"
                                   HorizontalOptions="Center">
                                <Image x:Name="pokemonSprite"
                                       WidthRequest="120"
                                       HeightRequest="120"
                                       Aspect="AspectFit"
                                       HorizontalOptions="Center" />
                            </Frame>

                            <!-- Name and Type -->
                            <Label x:Name="pokemonNameLabel"
                                   FontSize="22"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center" />
                            <Label x:Name="pokemonTypeLabel" 
                                   FontSize="13" 
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Center" />

                            <!-- Stats Container -->
                            <VerticalStackLayout x:Name="statsContainer" Spacing="6" Margin="0,8,0,0" />

                            <!-- Total BST -->
                            <Label x:Name="pokemonStatLabel" 
                                   FontSize="14" 
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center" />

                            <!-- Level Picker -->
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Label Text="Level:" VerticalOptions="Center" FontSize="13" />
                                <Picker x:Name="levelPicker" 
                                        WidthRequest="80"
                                        BackgroundColor="{DynamicResource SurfaceColor}"
                                        SelectedIndexChanged="OnLevelPickerChanged">
                                    <Picker.Items>
                                        <x:String>1</x:String>
                                        <x:String>5</x:String>
                                        <x:String>10</x:String>
                                        <x:String>25</x:String>
                                        <x:String>50</x:String>
                                        <x:String>75</x:String>
                                        <x:String>100</x:String>
                                    </Picker.Items>
                                </Picker>
                            </HorizontalStackLayout>

                            <!-- Height/Weight -->
                            <HorizontalStackLayout Spacing="16" HorizontalOptions="Center">
                                <Label x:Name="pokemonHeightLabel" FontSize="12" />
                                <Label x:Name="pokemonWeightLabel" FontSize="12" />
                            </HorizontalStackLayout>

                            <!-- Strengths/Weaknesses -->
                            <BoxView HeightRequest="1" Margin="0,6" HorizontalOptions="Fill" 
                                     Color="{DynamicResource DividerColor}" />
                            <Label x:Name="pokemonStrenghtLabel" FontSize="15" 
                                   TextColor="{DynamicResource SuccessColor}" />
                            <Label x:Name="pokemonWeaknessLabel" FontSize="15" 
                                   TextColor="{DynamicResource ErrorColor}" />

                            <!-- Abilities Section -->
                            <BoxView HeightRequest="1" Margin="0,6" HorizontalOptions="Fill" 
                                     Color="{DynamicResource DividerColor}" />
                            <Label Text="Abilities" 
                                   FontSize="16" 
                                   FontAttributes="Bold" />
                            <VerticalStackLayout x:Name="abilitiesContainer" Spacing="8" />

                            <!-- Buttons -->
                            <HorizontalStackLayout Spacing="12" Margin="0,12,0,0" HorizontalOptions="Center">
                                <Button x:Name="pokemonFavouriteButton"
                                        IsVisible="False"
                                        FontSize="12"
                                        Text="☆ Favourite"
                                        BackgroundColor="{DynamicResource TertiaryColor}"
                                        TextColor="{DynamicResource TextColor}"
                                        Clicked="OnFavouriteClicked" />

                                <Button x:Name="pokemonAddToTeamButton"
                                        IsVisible="False"
                                        FontSize="12"
                                        Text="+ Add to Team"
                                        BackgroundColor="{DynamicResource AccentColor}"
                                        Clicked="OnAddTeamButtonClicked" />
                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </ScrollView>
                </Frame>

                <!-- Right Column-->
                <Frame Grid.Column="1" 
                       Padding="20" 
                       CornerRadius="16" 
                       HasShadow="False"
                       BackgroundColor="{DynamicResource SurfaceColor}"
                       BorderColor="{DynamicResource BorderColor}">
                    <ScrollView>
                        <VerticalStackLayout Spacing="8">
                            <Label Text="Moves" 
                                   FontSize="20" 
                                   FontAttributes="Bold" 
                                   Margin="0,0,0,8" />
                            <Label x:Name="movesCountLabel"
                                   FontSize="20"
                                   Margin="0,0,0,8"
                                   Text=""/>

                            <VerticalStackLayout x:Name="movesContainer" Spacing="6">
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </ScrollView>
                </Frame>
            </Grid>
        </Frame>
    </Grid>

</ContentPage>

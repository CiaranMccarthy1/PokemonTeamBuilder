<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PokemonTeamBuilder.MainPage"
             Title="Pokédex">

    <Grid Padding="16" RowSpacing="12">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Button x:Name="backToTeamButton"
                Grid.Row="0"
                Text="← Back to Team"
                IsVisible="False"
                BackgroundColor="{DynamicResource SecondaryColor}"
                HorizontalOptions="Start"
                Clicked="OnBackToTeamClicked" />

        <Frame Grid.Row="1" Padding="0" CornerRadius="25" HasShadow="False"
               BackgroundColor="{DynamicResource FrameBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}">
            <SearchBar x:Name="searchBar"
                       Placeholder="Search Pokémon..."
                       TextChanged="searchBar_TextChanged"
                       SearchButtonPressed="OnSearchBarPressed"
                       BackgroundColor="Transparent"
                       HorizontalOptions="Fill" />
        </Frame>

        <Frame Grid.Row="2" Padding="0" CornerRadius="12" HasShadow="False"
               IsVisible="{Binding Source={x:Reference suggestionListView}, Path=IsVisible}"
               BackgroundColor="{DynamicResource CardBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}">
            <ListView x:Name="suggestionListView"
                      ItemSelected="suggestionListView_ItemSelected"
                      HeightRequest="150"
                      IsVisible="False"
                      BackgroundColor="Transparent"
                      SeparatorColor="{DynamicResource DividerColor}"
                      HorizontalOptions="Fill" />
        </Frame>

        <!-- Pokemon Grid -->
        <CollectionView x:Name="allPokemonCollectionView"
                        Grid.Row="3"
                        IsVisible="True"
                        SelectionMode="Single"
                        SelectionChanged="AllPokemonCollectionView_SelectionChanged"
                        BackgroundColor="Transparent">

            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" Span="4" HorizontalItemSpacing="8" VerticalItemSpacing="8" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="8" CornerRadius="16" HasShadow="False"
                           BackgroundColor="{DynamicResource CardBackgroundColor}"
                           BorderColor="{DynamicResource BorderColor}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                            <Frame WidthRequest="70" HeightRequest="70" CornerRadius="35" 
                                   Padding="5" HasShadow="False"
                                   BackgroundColor="{DynamicResource SurfaceColor}"
                                   BorderColor="Transparent">
                                <Image Source="{Binding SpriteUrl}"
                                       WidthRequest="60"
                                       HeightRequest="60"
                                       Aspect="AspectFit" />
                            </Frame>
                            <Label Text="{Binding Name}"
                                   FontSize="11"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   LineBreakMode="TailTruncation"
                                   MaxLines="1"/>
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
        
        <!-- Pokemon Details Grid -->
        <Frame x:Name="pokemonDetailsGrid" 
               Grid.Row="0" 
               Grid.RowSpan="4"
               Padding="20"
               CornerRadius="20"
               IsVisible="False"
               BackgroundColor="{DynamicResource CardBackgroundColor}"
               BorderColor="{DynamicResource BorderColor}"
               HasShadow="False"
               HorizontalOptions="Center"
               VerticalOptions="Center">
            
            <Grid ColumnSpacing="30">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Left Column - Image and Name -->
                <VerticalStackLayout Grid.Column="0" Spacing="16" 
                                     HorizontalOptions="Center" VerticalOptions="Center">

                    <Button x:Name="backButton"
                            Text="← Back"
                            FontSize="14"
                            Clicked="OnBackButtonClicked"
                            BackgroundColor="{DynamicResource SecondaryColor}"
                            HorizontalOptions="Start" />

                    <Frame WidthRequest="200" HeightRequest="200" CornerRadius="100" 
                           Padding="10" HasShadow="False"
                           BackgroundColor="{DynamicResource SurfaceColor}"
                           BorderColor="{DynamicResource BorderColor}"
                           HorizontalOptions="Center">
                        <Image x:Name="pokemonSprite"
                               WidthRequest="180"
                               HeightRequest="180"
                               Aspect="AspectFit"
                               HorizontalOptions="Center" />
                    </Frame>

                    <Label x:Name="pokemonNameLabel"
                           FontSize="24"
                           FontAttributes="Bold"
                           HorizontalOptions="Center" />

                </VerticalStackLayout>

                <!-- Right Column - Details -->
                <VerticalStackLayout Grid.Column="1" Spacing="12" Padding="10" 
                                     HorizontalOptions="Start" VerticalOptions="Center">

                    <Label x:Name="pokemonHeightLabel" FontSize="15" />
                    <Label x:Name="pokemonWeightLabel" FontSize="15" />
                    <Label x:Name="pokemonTypeLabel" FontSize="15" FontAttributes="Bold" />
                    <Label x:Name="pokemonStatLabel" FontSize="15" />

                    <BoxView HeightRequest="1" Margin="0,8" HorizontalOptions="Fill" />

                    <Label x:Name="pokemonStrenghtLabel" FontSize="14" TextColor="{DynamicResource SuccessColor}" />
                    <Label x:Name="pokemonWeaknessLabel" FontSize="14" TextColor="{DynamicResource ErrorColor}" />

                    <HorizontalStackLayout Spacing="12" Margin="0,16,0,0">
                        <Button x:Name="pokemonFavouriteButton"
                                IsVisible="False"
                                FontSize="14"
                                Text="☆ Favourite"
                                BackgroundColor="{DynamicResource TertiaryColor}"
                                TextColor="{DynamicResource TextColor}"
                                Clicked="OnFavouriteClicked" />

                        <Button x:Name="pokemonAddToTeamButton"
                                IsVisible="False"
                                FontSize="14"
                                Text="+ Add to Team"
                                BackgroundColor="{DynamicResource AccentColor}"
                                Clicked="OnAddTeamButtonClicked" />
                    </HorizontalStackLayout>

                </VerticalStackLayout>
            </Grid>
        </Frame>
    </Grid>

</ContentPage>
